//var po = org.polymaps;

//var map = po.map()
    //.container(document.getElementById("map").appendChild(po.svg("svg")))
    map.zoom(3)
    .zoomRange([3, 13]);
map.on("move", update2)

var testData = JSON.parse('{"centers": [{"x": 37.787, "y": -122.228, "r": 37.60}]}')
//var rawData1 = {"clusters": [testData, testData, testData, testData, testData, testData, testData, testData, testData, testData]};
var rawData1 = JSON.parse('{"clusters": [{"centers": [{"x": 39.125000000000014,"y": -110.50000000000003, "r": -110.65217528590027, "d": 48.0},{"x": 45.24500000000002,"y": -85.30000000000007, "r": -85.45217528590031, "d": 46.0},{"x": 40.655000000000015,"y": -100.42000000000004, "r": -100.57217528590029, "d": 6.0},{"x": 33.00500000000001,"y": -118.06000000000003, "r": -118.21217528590026, "d": 100.0},{"x": 33.00500000000001,"y": -92.86000000000007, "r": -93.0121752859003, "d": 65.0},{"x": 39.125000000000014,"y": -123.10000000000002, "r": -123.25217528590025, "d": 96.0},{"x": 40.655000000000015,"y": -115.54000000000002, "r": -115.69217528590026, "d": 19.0},{"x": 45.24500000000002,"y": -92.86000000000007, "r": -93.0121752859003, "d": 100.0},{"x": 39.125000000000014,"y": -90.34000000000006, "r": -90.4921752859003, "d": 100.0},{"x": 40.655000000000015,"y": -80.26000000000008, "r": -80.41217528590032, "d": 100.0},{"x": 28.415000000000006,"y": -97.90000000000006, "r": -98.05217528590029, "d": 98.0},{"x": 45.24500000000002,"y": -123.10000000000002, "r": -123.25217528590025, "d": 100.0},{"x": 33.00500000000001,"y": -113.02000000000004, "r": -113.17217528590027, "d": 100.0},{"x": 31.47500000000001,"y": -97.90000000000006, "r": -98.05217528590029, "d": 100.0},{"x": 48.30500000000002,"y": -100.42000000000004, "r": -100.57217528590029, "d": 14.0},{"x": 48.30500000000002,"y": -107.98000000000005, "r": -108.13217528590027, "d": 15.0},{"x": 28.415000000000006,"y": -107.98000000000005, "r": -108.13217528590027, "d": 11.0},{"x": 39.125000000000014,"y": -115.54000000000002, "r": -115.69217528590026, "d": 20.0},{"x": 31.47500000000001,"y": -90.34000000000006, "r": -90.4921752859003, "d": 99.0},{"x": 34.53500000000001,"y": -115.54000000000002, "r": -115.69217528590026, "d": 74.0},{"x": 42.18500000000002,"y": -123.10000000000002, "r": -123.25217528590025, "d": 20.0},{"x": 20.765,"y": -100.42000000000004, "r": -100.57217528590029, "d": 100.0},{"x": 31.47500000000001,"y": -115.54000000000002, "r": -115.69217528590026, "d": 32.0},{"x": 29.945000000000007,"y": -80.26000000000008, "r": -80.41217528590032, "d": 101.0},{"x": 33.00500000000001,"y": -87.82000000000008, "r": -87.9721752859003, "d": 100.0},{"x": 43.71500000000002,"y": -97.90000000000006, "r": -98.05217528590029, "d": 16.0},{"x": 33.00500000000001,"y": -95.38000000000005, "r": -95.5321752859003, "d": 101.0},{"x": 42.18500000000002,"y": -105.46000000000004, "r": -105.61217528590028, "d": 6.0},{"x": 23.825000000000003,"y": -105.46000000000004, "r": -105.61217528590028, "d": 85.0},{"x": 45.24500000000002,"y": -90.34000000000006, "r": -90.4921752859003, "d": 100.0},{"x": 28.415000000000006,"y": -80.26000000000008, "r": -80.41217528590032, "d": 99.0},{"x": 37.59500000000001,"y": -82.78000000000009, "r": -82.93217528590031, "d": 100.0},{"x": 43.71500000000002,"y": -123.10000000000002, "r": -123.25217528590025, "d": 50.0},{"x": 31.47500000000001,"y": -82.78000000000009, "r": -82.93217528590031, "d": 100.0},{"x": 20.765,"y": -105.46000000000004, "r": -105.61217528590028, "d": 84.0},{"x": 48.30500000000002,"y": -123.10000000000002, "r": -123.25217528590025, "d": 100.0},{"x": 36.06500000000001,"y": -115.54000000000002, "r": -115.69217528590026, "d": 99.0},{"x": 45.24500000000002,"y": -100.42000000000004, "r": -100.57217528590029, "d": 14.0},{"x": 36.06500000000001,"y": -95.38000000000005, "r": -95.5321752859003, "d": 96.0},{"x": 22.295,"y": -85.30000000000007, "r": -85.45217528590031, "d": 15.0},{"x": 40.655000000000015,"y": -125.62, "r": -125.77217528590025, "d": 6.0},{"x": 34.53500000000001,"y": -118.06000000000003, "r": -118.21217528590026, "d": 100.0},{"x": 36.06500000000001,"y": -80.26000000000008, "r": -80.41217528590032, "d": 104.0},{"x": 40.655000000000015,"y": -123.10000000000002, "r": -123.25217528590025, "d": 12.0},{"x": 42.18500000000002,"y": -80.26000000000008, "r": -80.41217528590032, "d": 100.0},{"x": 45.24500000000002,"y": -87.82000000000008, "r": -87.9721752859003, "d": 100.0},{"x": 37.59500000000001,"y": -120.58000000000001, "r": -120.73217528590025, "d": 100.0},{"x": 26.885000000000005,"y": -100.42000000000004, "r": -100.57217528590029, "d": 100.0},{"x": 25.355000000000004,"y": -80.26000000000008, "r": -80.41217528590032, "d": 100.0},{"x": 45.24500000000002,"y": -97.90000000000006, "r": -98.05217528590029, "d": 80.0},{"x": 22.295,"y": -97.90000000000006, "r": -98.05217528590029, "d": 45.0},{"x": 20.765,"y": -85.30000000000007, "r": -85.45217528590031, "d": 17.0},{"x": 34.53500000000001,"y": -85.30000000000007, "r": -85.45217528590031, "d": 100.0},{"x": 39.125000000000014,"y": -92.86000000000007, "r": -93.0121752859003, "d": 100.0},{"x": 37.59500000000001,"y": -92.86000000000007, "r": -93.0121752859003, "d": 100.0},{"x": 22.295,"y": -82.78000000000009, "r": -82.93217528590031, "d": 100.0},{"x": 34.53500000000001,"y": -107.98000000000005, "r": -108.13217528590027, "d": 55.0},{"x": 42.18500000000002,"y": -85.30000000000007, "r": -85.45217528590031, "d": 100.0},{"x": 29.945000000000007,"y": -97.90000000000006, "r": -98.05217528590029, "d": 101.0},{"x": 46.77500000000002,"y": -80.26000000000008, "r": -80.41217528590032, "d": 13.0},{"x": 23.825000000000003,"y": -97.90000000000006, "r": -98.05217528590029, "d": 9.0},{"x": 43.71500000000002,"y": -102.94000000000005, "r": -103.09217528590028, "d": 9.0},{"x": 42.18500000000002,"y": -113.02000000000004, "r": -113.17217528590027, "d": 9.0},{"x": 42.18500000000002,"y": -110.50000000000003, "r": -110.65217528590027, "d": 7.0},{"x": 37.59500000000001,"y": -107.98000000000005, "r": -108.13217528590027, "d": 13.0},{"x": 34.53500000000001,"y": -105.46000000000004, "r": -105.61217528590028, "d": 59.0},{"x": 37.59500000000001,"y": -80.26000000000008, "r": -80.41217528590032, "d": 100.0},{"x": 46.77500000000002,"y": -102.94000000000005, "r": -103.09217528590028, "d": 46.0},{"x": 42.18500000000002,"y": -90.34000000000006, "r": -90.4921752859003, "d": 100.0},{"x": 43.71500000000002,"y": -110.50000000000003, "r": -110.65217528590027, "d": 42.0},{"x": 25.355000000000004,"y": -102.94000000000005, "r": -103.09217528590028, "d": 12.0},{"x": 31.47500000000001,"y": -100.42000000000004, "r": -100.57217528590029, "d": 100.0},{"x": 42.18500000000002,"y": -82.78000000000009, "r": -82.93217528590031, "d": 100.0},{"x": 45.24500000000002,"y": -80.26000000000008, "r": -80.41217528590032, "d": 19.0},{"x": 26.885000000000005,"y": -97.90000000000006, "r": -98.05217528590029, "d": 96.0},{"x": 45.24500000000002,"y": -82.78000000000009, "r": -82.93217528590031, "d": 9.0},{"x": 40.655000000000015,"y": -82.78000000000009, "r": -82.93217528590031, "d": 100.0},{"x": 34.53500000000001,"y": -87.82000000000008, "r": -87.9721752859003, "d": 100.0},{"x": 34.53500000000001,"y": -95.38000000000005, "r": -95.5321752859003, "d": 34.0},{"x": 25.355000000000004,"y": -107.98000000000005, "r": -108.13217528590027, "d": 15.0},{"x": 36.06500000000001,"y": -90.34000000000006, "r": -90.4921752859003, "d": 100.0},{"x": 22.295,"y": -107.98000000000005, "r": -108.13217528590027, "d": 17.0},{"x": 43.71500000000002,"y": -85.30000000000007, "r": -85.45217528590031, "d": 100.0},{"x": 39.125000000000014,"y": -107.98000000000005, "r": -108.13217528590027, "d": 16.0},{"x": 37.59500000000001,"y": -85.30000000000007, "r": -85.45217528590031, "d": 100.0},{"x": 43.71500000000002,"y": -92.86000000000007, "r": -93.0121752859003, "d": 48.0},{"x": 36.06500000000001,"y": -120.58000000000001, "r": -120.73217528590025, "d": 100.0},{"x": 33.00500000000001,"y": -97.90000000000006, "r": -98.05217528590029, "d": 101.0},{"x": 33.00500000000001,"y": -105.46000000000004, "r": -105.61217528590028, "d": 21.0},{"x": 34.53500000000001,"y": -92.86000000000007, "r": -93.0121752859003, "d": 54.0},{"x": 26.885000000000005,"y": -80.26000000000008, "r": -80.41217528590032, "d": 63.0},{"x": 33.00500000000001,"y": -82.78000000000009, "r": -82.93217528590031, "d": 99.0},{"x": 46.77500000000002,"y": -123.10000000000002, "r": -123.25217528590025, "d": 100.0},{"x": 28.415000000000006,"y": -82.78000000000009, "r": -82.93217528590031, "d": 99.0},{"x": 31.47500000000001,"y": -92.86000000000007, "r": -93.0121752859003, "d": 67.0},{"x": 22.295,"y": -102.94000000000005, "r": -103.09217528590028, "d": 44.0},{"x": 29.945000000000007,"y": -90.34000000000006, "r": -90.4921752859003, "d": 100.0},{"x": 20.765,"y": -97.90000000000006, "r": -98.05217528590029, "d": 101.0},{"x": 23.825000000000003,"y": -100.42000000000004, "r": -100.57217528590029, "d": 10.0},{"x": 33.00500000000001,"y": -80.26000000000008, "r": -80.41217528590032, "d": 99.0},{"x": 40.655000000000015,"y": -113.02000000000004, "r": -113.17217528590027, "d": 101.0},{"x": 29.945000000000007,"y": -95.38000000000005, "r": -95.5321752859003, "d": 101.0},{"x": 46.77500000000002,"y": -95.38000000000005, "r": -95.5321752859003, "d": 38.0},{"x": 39.125000000000014,"y": -95.38000000000005, "r": -95.5321752859003, "d": 100.0},{"x": 33.00500000000001,"y": -100.42000000000004, "r": -100.57217528590029, "d": 43.0},{"x": 29.945000000000007,"y": -110.50000000000003, "r": -110.65217528590027, "d": 31.0},{"x": 36.06500000000001,"y": -100.42000000000004, "r": -100.57217528590029, "d": 6.0},{"x": 25.355000000000004,"y": -105.46000000000004, "r": -105.61217528590028, "d": 12.0},{"x": 23.825000000000003,"y": -102.94000000000005, "r": -103.09217528590028, "d": 9.0}]}, {"centers": [{"x": 20.765,"y": -99.16000000000005, "r": -106.10659852917607, "d": 35.625},{"x": 43.71500000000002,"y": -107.98000000000005, "r": -113.86897131024082, "d": 8.0},{"x": 46.01000000000002,"y": -96.64000000000006, "r": -96.02659852917608, "d": 16.75},{"x": 23.060000000000002,"y": -84.04000000000008, "r": -83.4265985291761, "d": 16.5},{"x": 20.765,"y": -106.72000000000004, "r": -113.66659852917606, "d": 35.625},{"x": 46.77500000000002,"y": -115.54000000000002, "r": -121.42897131024081, "d": 14.714286},{"x": 47.54000000000002,"y": -90.34000000000006, "r": -89.38435057180054, "d": 25.0},{"x": 28.415000000000006,"y": -104.20000000000005, "r": -111.14659852917606, "d": 13.875},{"x": 30.710000000000008,"y": -114.28000000000003, "r": -116.18659852917605, "d": 8.0},{"x": 20.765,"y": -101.68000000000005, "r": -108.62659852917606, "d": 35.625},{"x": 45.24500000000002,"y": -82.78000000000009, "r": -81.10897131024088, "d": 15.714286},{"x": 33.00500000000001,"y": -94.12000000000006, "r": -101.06659852917608, "d": 38.625},{"x": 31.47500000000001,"y": -94.12000000000006, "r": -101.06659852917608, "d": 33.25},{"x": 43.71500000000002,"y": -123.10000000000002, "r": -126.92282863211867, "d": 10.0},{"x": 20.765,"y": -96.64000000000006, "r": -103.58659852917607, "d": 35.625},{"x": 22.295,"y": -106.72000000000004, "r": -113.66659852917606, "d": 13.25},{"x": 42.18500000000002,"y": -121.84000000000002, "r": -126.68639472601093, "d": 3.5},{"x": 36.83000000000001,"y": -107.98000000000005, "r": -106.10659852917607, "d": 10.5},{"x": 36.06500000000001,"y": -95.38000000000005, "r": -101.26897131024084, "d": 28.857143},{"x": 36.83000000000001,"y": -105.46000000000004, "r": -103.58659852917607, "d": 10.75},{"x": 25.355000000000004,"y": -111.76000000000003, "r": -118.70659852917605, "d": 3.5},{"x": 29.945000000000007,"y": -94.12000000000006, "r": -101.06659852917608, "d": 25.125},{"x": 44.48000000000002,"y": -92.86000000000007, "r": -90.98659852917609, "d": 18.5},{"x": 49.07000000000002,"y": -104.20000000000005, "r": -106.10659852917607, "d": 3.625},{"x": 23.825000000000003,"y": -104.20000000000005, "r": -111.14659852917606, "d": 13.625},{"x": 29.945000000000007,"y": -96.64000000000006, "r": -103.58659852917607, "d": 25.125},{"x": 39.890000000000015,"y": -96.64000000000006, "r": -96.02659852917608, "d": 12.5},{"x": 46.77500000000002,"y": -87.82000000000008, "r": -86.60282863211873, "d": 20.4},{"x": 38.360000000000014,"y": -80.26000000000008, "r": -78.38659852917611, "d": 37.875},{"x": 48.30500000000002,"y": -80.26000000000008, "r": -79.60119130929883, "d": 4.3333335},{"x": 45.24500000000002,"y": -116.80000000000003, "r": -123.74659852917604, "d": 12.75},{"x": 36.83000000000001,"y": -84.04000000000008, "r": -83.4265985291761, "d": 12.5},{"x": 26.120000000000005,"y": -80.26000000000008, "r": -78.38659852917611, "d": 45.375},{"x": 39.125000000000014,"y": -90.34000000000006, "r": -89.68119130929881, "d": 33.333332},{"x": 20.765,"y": -104.20000000000005, "r": -111.14659852917606, "d": 35.625}]}, {"centers": [{"x": 24.590000000000003,"y": -84.04000000000008, "r": -82.72238261859756, "d": 19.25},{"x": 46.77500000000002,"y": -115.54000000000002, "r": -121.42897131024081, "d": 14.714286},{"x": 20.765,"y": -106.72000000000004, "r": -122.44870114360096, "d": 17.8125},{"x": 30.710000000000008,"y": -119.32000000000002, "r": -124.96870114360095, "d": 4.0},{"x": 39.890000000000015,"y": -101.68000000000005, "r": -101.06659852917608, "d": 1.125},{"x": 20.765,"y": -109.24000000000004, "r": -124.96870114360095, "d": 17.8125},{"x": 28.415000000000006,"y": -106.72000000000004, "r": -122.44870114360096, "d": 6.9375},{"x": 42.18500000000002,"y": -121.84000000000002, "r": -126.68639472601093, "d": 3.5},{"x": 43.71500000000002,"y": -114.28000000000003, "r": -125.5623826185975, "d": 8.833333},{"x": 47.54000000000002,"y": -94.12000000000006, "r": -94.728701143601, "d": 13.8125},{"x": 45.24500000000002,"y": -81.52000000000008, "r": -79.89489947523796, "d": 10.142858},{"x": 23.825000000000003,"y": -110.50000000000003, "r": -125.10941333177463, "d": 7.266667},{"x": 22.295,"y": -110.50000000000003, "r": -125.10941333177463, "d": 7.0666666},{"x": 49.07000000000002,"y": -104.20000000000005, "r": -106.10659852917607, "d": 3.625},{"x": 45.24500000000002,"y": -115.54000000000002, "r": -123.55652585770072, "d": 11.333333},{"x": 25.355000000000004,"y": -110.50000000000003, "r": -125.10941333177463, "d": 1.8666667},{"x": 46.77500000000002,"y": -86.56000000000007, "r": -85.57675065521997, "d": 14.8},{"x": 39.125000000000014,"y": -126.88000000000001, "r": -126.68639472601093, "d": 1.0},{"x": 36.83000000000001,"y": -106.72000000000004, "r": -104.80870114360098, "d": 10.625},{"x": 36.83000000000001,"y": -84.04000000000008, "r": -83.4265985291761, "d": 12.5}]}, {"centers": [{"x": 49.07000000000002,"y": -114.28000000000003, "r": -123.97278945202186, "d": 5.5},{"x": 46.77500000000002,"y": -115.54000000000002, "r": -121.42897131024081, "d": 14.714286},{"x": 24.590000000000003,"y": -85.30000000000007, "r": -84.37989779376413, "d": 12.833333},{"x": 39.890000000000015,"y": -121.84000000000002, "r": -123.97278945202186, "d": 10.875},{"x": 39.890000000000015,"y": -101.68000000000005, "r": -101.06659852917608, "d": 1.125},{"x": 44.48000000000002,"y": -114.28000000000003, "r": -123.97278945202186, "d": 9.25},{"x": 47.54000000000002,"y": -94.12000000000006, "r": -94.728701143601, "d": 13.8125},{"x": 45.24500000000002,"y": -81.52000000000008, "r": -79.89489947523796, "d": 10.142858},{"x": 23.825000000000003,"y": -110.50000000000003, "r": -125.10941333177463, "d": 7.266667},{"x": 22.295,"y": -110.50000000000003, "r": -125.10941333177463, "d": 7.0666666},{"x": 25.355000000000004,"y": -110.50000000000003, "r": -125.10941333177463, "d": 1.8666667},{"x": 46.77500000000002,"y": -86.56000000000007, "r": -85.57675065521997, "d": 14.8},{"x": 36.83000000000001,"y": -106.72000000000004, "r": -104.80870114360098, "d": 10.625},{"x": 36.83000000000001,"y": -84.04000000000008, "r": -83.4265985291761, "d": 12.5},{"x": 30.710000000000008,"y": -121.84000000000002, "r": -121.45278945202186, "d": 4.375}]}, {"centers": [{"x": 49.07000000000002,"y": -114.28000000000003, "r": -123.97278945202186, "d": 5.5},{"x": 46.77500000000002,"y": -115.54000000000002, "r": -121.42897131024081, "d": 14.714286},{"x": 24.590000000000003,"y": -85.30000000000007, "r": -84.37989779376413, "d": 12.833333},{"x": 39.890000000000015,"y": -121.84000000000002, "r": -123.97278945202186, "d": 10.875},{"x": 46.77500000000002,"y": -91.60000000000007, "r": -93.09219414325854, "d": 11.1},{"x": 26.120000000000005,"y": -110.50000000000003, "r": -123.33219414325849, "d": 7.633333},{"x": 44.48000000000002,"y": -114.28000000000003, "r": -123.97278945202186, "d": 9.25},{"x": 36.83000000000001,"y": -104.20000000000005, "r": -102.97319705835211, "d": 9.875},{"x": 45.24500000000002,"y": -81.52000000000008, "r": -79.89489947523796, "d": 10.142858},{"x": 36.83000000000001,"y": -84.04000000000008, "r": -83.4265985291761, "d": 12.5},{"x": 23.060000000000002,"y": -110.50000000000003, "r": -123.33219414325849, "d": 7.1666665}]}, {"centers": [{"x": 49.07000000000002,"y": -114.28000000000003, "r": -123.97278945202186, "d": 5.5},{"x": 24.590000000000003,"y": -85.30000000000007, "r": -84.37989779376413, "d": 12.833333},{"x": 26.120000000000005,"y": -110.50000000000003, "r": -123.33219414325849, "d": 7.633333},{"x": 36.83000000000001,"y": -104.20000000000005, "r": -102.97319705835211, "d": 9.875},{"x": 45.24500000000002,"y": -114.28000000000003, "r": -122.75305171540143, "d": 7.5277777},{"x": 42.18500000000002,"y": -82.78000000000009, "r": -80.1960315284709, "d": 8.848485},{"x": 38.360000000000014,"y": -121.84000000000002, "r": -122.75305171540143, "d": 12.055555},{"x": 23.060000000000002,"y": -110.50000000000003, "r": -123.33219414325849, "d": 7.1666665}]}, {"centers": [{"x": 49.07000000000002,"y": -114.28000000000003, "r": -123.97278945202186, "d": 5.5},{"x": 24.590000000000003,"y": -85.30000000000007, "r": -84.37989779376413, "d": 12.833333},{"x": 26.885000000000005,"y": -110.50000000000003, "r": -121.96848589635599, "d": 7.5555553},{"x": 36.83000000000001,"y": -104.20000000000005, "r": -102.97319705835211, "d": 9.875},{"x": 45.24500000000002,"y": -114.28000000000003, "r": -122.75305171540143, "d": 7.5277777},{"x": 42.18500000000002,"y": -82.78000000000009, "r": -80.1960315284709, "d": 8.848485},{"x": 38.360000000000014,"y": -121.84000000000002, "r": -122.75305171540143, "d": 12.055555},{"x": 23.060000000000002,"y": -110.50000000000003, "r": -123.33219414325849, "d": 7.1666665}]}, {"centers": [{"x": 49.07000000000002,"y": -114.28000000000003, "r": -123.97278945202186, "d": 5.5},{"x": 24.590000000000003,"y": -85.30000000000007, "r": -84.37989779376413, "d": 12.833333},{"x": 26.885000000000005,"y": -110.50000000000003, "r": -121.96848589635599, "d": 7.5555553},{"x": 36.83000000000001,"y": -104.20000000000005, "r": -102.97319705835211, "d": 9.875},{"x": 45.24500000000002,"y": -114.28000000000003, "r": -122.75305171540143, "d": 7.5277777},{"x": 42.18500000000002,"y": -82.78000000000009, "r": -80.1960315284709, "d": 8.848485},{"x": 38.360000000000014,"y": -121.84000000000002, "r": -122.75305171540143, "d": 12.055555},{"x": 23.060000000000002,"y": -110.50000000000003, "r": -123.33219414325849, "d": 7.1666665}]}, {"centers": [{"x": 24.590000000000003,"y": -85.30000000000007, "r": -84.37989779376413, "d": 12.833333},{"x": 26.885000000000005,"y": -110.50000000000003, "r": -121.96848589635599, "d": 7.5555553},{"x": 36.83000000000001,"y": -104.20000000000005, "r": -102.97319705835211, "d": 9.875},{"x": 42.18500000000002,"y": -82.78000000000009, "r": -80.1960315284709, "d": 8.848485},{"x": 46.77500000000002,"y": -114.28000000000003, "r": -120.81882666354926, "d": 4.7833333},{"x": 38.360000000000014,"y": -121.84000000000002, "r": -122.75305171540143, "d": 12.055555},{"x": 23.060000000000002,"y": -110.50000000000003, "r": -123.33219414325849, "d": 7.1666665}]}, {"centers": [{"x": 24.590000000000003,"y": -85.30000000000007, "r": -84.37989779376413, "d": 12.833333},{"x": 26.885000000000005,"y": -110.50000000000003, "r": -121.96848589635599, "d": 7.5555553},{"x": 36.83000000000001,"y": -104.20000000000005, "r": -102.97319705835211, "d": 9.875},{"x": 42.18500000000002,"y": -82.78000000000009, "r": -80.1960315284709, "d": 8.848485},{"x": 46.77500000000002,"y": -114.28000000000003, "r": -120.81882666354926, "d": 4.7833333},{"x": 38.360000000000014,"y": -121.84000000000002, "r": -122.75305171540143, "d": 12.055555},{"x": 23.060000000000002,"y": -110.50000000000003, "r": -123.33219414325849, "d": 7.1666665}]}, {"centers": [{"x": 36.83000000000001,"y": -104.20000000000005, "r": -102.97319705835211, "d": 9.875},{"x": 46.77500000000002,"y": -114.28000000000003, "r": -120.81882666354926, "d": 4.7833333},{"x": 35.30000000000001,"y": -84.04000000000008, "r": -79.17131452847471, "d": 7.3625},{"x": 38.360000000000014,"y": -121.84000000000002, "r": -122.75305171540143, "d": 12.055555},{"x": 25.355000000000004,"y": -110.50000000000003, "r": -119.80595654649373, "d": 7.386667}]}]}');

var rawData2 = JSON.parse('{"clusters": [{"centers": [{"x": 40.655000000000015,"y": -97.90000000000006, "r": -98.05217528590029, "d": 9.0},{"x": 34.53500000000001,"y": -120.58000000000001, "r": -120.73217528590025, "d": 99.0},{"x": 28.415000000000006,"y": -110.50000000000003, "r": -110.65217528590027, "d": 25.0},{"x": 34.53500000000001,"y": -115.54000000000002, "r": -115.69217528590026, "d": 100.0},{"x": 45.24500000000002,"y": -90.34000000000006, "r": -90.4921752859003, "d": 15.0},{"x": 33.00500000000001,"y": -102.94000000000005, "r": -103.09217528590028, "d": 12.0},{"x": 36.06500000000001,"y": -102.94000000000005, "r": -103.09217528590028, "d": 5.0},{"x": 34.53500000000001,"y": -97.90000000000006, "r": -98.05217528590029, "d": 100.0},{"x": 33.00500000000001,"y": -113.02000000000004, "r": -113.17217528590027, "d": 100.0},{"x": 23.825000000000003,"y": -105.46000000000004, "r": -105.61217528590028, "d": 17.0},{"x": 43.71500000000002,"y": -80.26000000000008, "r": -80.41217528590032, "d": 99.0},{"x": 28.415000000000006,"y": -100.42000000000004, "r": -100.57217528590029, "d": 8.0},{"x": 33.00500000000001,"y": -90.34000000000006, "r": -90.4921752859003, "d": 24.0},{"x": 39.125000000000014,"y": -120.58000000000001, "r": -120.73217528590025, "d": 99.0},{"x": 31.47500000000001,"y": -90.34000000000006, "r": -90.4921752859003, "d": 23.0},{"x": 42.18500000000002,"y": -90.34000000000006, "r": -90.4921752859003, "d": 57.0},{"x": 33.00500000000001,"y": -105.46000000000004, "r": -105.61217528590028, "d": 8.0},{"x": 20.765,"y": -100.42000000000004, "r": -100.57217528590029, "d": 100.0},{"x": 26.885000000000005,"y": -82.78000000000009, "r": -82.93217528590031, "d": 40.0},{"x": 43.71500000000002,"y": -85.30000000000007, "r": -85.45217528590031, "d": 27.0},{"x": 22.295,"y": -80.26000000000008, "r": -80.41217528590032, "d": 100.0},{"x": 29.945000000000007,"y": -87.82000000000008, "r": -87.9721752859003, "d": 15.0},{"x": 39.125000000000014,"y": -92.86000000000007, "r": -93.0121752859003, "d": 30.0},{"x": 20.765,"y": -97.90000000000006, "r": -98.05217528590029, "d": 100.0},{"x": 49.83500000000002,"y": -85.30000000000007, "r": -85.45217528590031, "d": 8.0},{"x": 37.59500000000001,"y": -85.30000000000007, "r": -85.45217528590031, "d": 50.0},{"x": 45.24500000000002,"y": -110.50000000000003, "r": -110.65217528590027, "d": 17.0},{"x": 37.59500000000001,"y": -82.78000000000009, "r": -82.93217528590031, "d": 26.0},{"x": 23.825000000000003,"y": -107.98000000000005, "r": -108.13217528590027, "d": 17.0},{"x": 25.355000000000004,"y": -97.90000000000006, "r": -98.05217528590029, "d": 43.0},{"x": 34.53500000000001,"y": -118.06000000000003, "r": -118.21217528590026, "d": 100.0},{"x": 25.355000000000004,"y": -100.42000000000004, "r": -100.57217528590029, "d": 25.0},{"x": 22.295,"y": -82.78000000000009, "r": -82.93217528590031, "d": 47.0},{"x": 34.53500000000001,"y": -80.26000000000008, "r": -80.41217528590032, "d": 100.0},{"x": 42.18500000000002,"y": -92.86000000000007, "r": -93.0121752859003, "d": 14.0},{"x": 40.655000000000015,"y": -80.26000000000008, "r": -80.41217528590032, "d": 98.0},{"x": 31.47500000000001,"y": -105.46000000000004, "r": -105.61217528590028, "d": 14.0},{"x": 22.295,"y": -100.42000000000004, "r": -100.57217528590029, "d": 15.0},{"x": 39.125000000000014,"y": -105.46000000000004, "r": -105.61217528590028, "d": 89.0},{"x": 36.06500000000001,"y": -95.38000000000005, "r": -95.5321752859003, "d": 10.0},{"x": 40.655000000000015,"y": -110.50000000000003, "r": -110.65217528590027, "d": 20.0},{"x": 43.71500000000002,"y": -123.10000000000002, "r": -123.25217528590025, "d": 27.0},{"x": 40.655000000000015,"y": -105.46000000000004, "r": -105.61217528590028, "d": 80.0},{"x": 29.945000000000007,"y": -82.78000000000009, "r": -82.93217528590031, "d": 99.0},{"x": 37.59500000000001,"y": -120.58000000000001, "r": -120.73217528590025, "d": 99.0},{"x": 29.945000000000007,"y": -92.86000000000007, "r": -93.0121752859003, "d": 42.0},{"x": 37.59500000000001,"y": -97.90000000000006, "r": -98.05217528590029, "d": 20.0},{"x": 22.295,"y": -102.94000000000005, "r": -103.09217528590028, "d": 8.0},{"x": 36.06500000000001,"y": -92.86000000000007, "r": -93.0121752859003, "d": 26.0},{"x": 34.53500000000001,"y": -92.86000000000007, "r": -93.0121752859003, "d": 9.0},{"x": 42.18500000000002,"y": -87.82000000000008, "r": -87.9721752859003, "d": 98.0},{"x": 34.53500000000001,"y": -95.38000000000005, "r": -95.5321752859003, "d": 6.0},{"x": 22.295,"y": -107.98000000000005, "r": -108.13217528590027, "d": 5.0},{"x": 34.53500000000001,"y": -87.82000000000008, "r": -87.9721752859003, "d": 13.0},{"x": 31.47500000000001,"y": -110.50000000000003, "r": -110.65217528590027, "d": 38.0},{"x": 20.765,"y": -90.34000000000006, "r": -90.4921752859003, "d": 7.0},{"x": 36.06500000000001,"y": -90.34000000000006, "r": -90.4921752859003, "d": 76.0},{"x": 43.71500000000002,"y": -87.82000000000008, "r": -87.9721752859003, "d": 34.0},{"x": 42.18500000000002,"y": -113.02000000000004, "r": -113.17217528590027, "d": 6.0},{"x": 39.125000000000014,"y": -90.34000000000006, "r": -90.4921752859003, "d": 57.0},{"x": 40.655000000000015,"y": -95.38000000000005, "r": -95.5321752859003, "d": 19.0},{"x": 29.945000000000007,"y": -110.50000000000003, "r": -110.65217528590027, "d": 20.0},{"x": 29.945000000000007,"y": -95.38000000000005, "r": -95.5321752859003, "d": 95.0},{"x": 36.06500000000001,"y": -80.26000000000008, "r": -80.41217528590032, "d": 91.0},{"x": 31.47500000000001,"y": -95.38000000000005, "r": -95.5321752859003, "d": 7.0},{"x": 34.53500000000001,"y": -110.50000000000003, "r": -110.65217528590027, "d": 27.0},{"x": 40.655000000000015,"y": -82.78000000000009, "r": -82.93217528590031, "d": 99.0},{"x": 22.295,"y": -97.90000000000006, "r": -98.05217528590029, "d": 7.0},{"x": 46.77500000000002,"y": -97.90000000000006, "r": -98.05217528590029, "d": 35.0},{"x": 43.71500000000002,"y": -115.54000000000002, "r": -115.69217528590026, "d": 14.0},{"x": 48.30500000000002,"y": -97.90000000000006, "r": -98.05217528590029, "d": 37.0},{"x": 29.945000000000007,"y": -100.42000000000004, "r": -100.57217528590029, "d": 36.0},{"x": 31.47500000000001,"y": -118.06000000000003, "r": -118.21217528590026, "d": 6.0},{"x": 31.47500000000001,"y": -80.26000000000008, "r": -80.41217528590032, "d": 8.0},{"x": 45.24500000000002,"y": -87.82000000000008, "r": -87.9721752859003, "d": 12.0},{"x": 31.47500000000001,"y": -87.82000000000008, "r": -87.9721752859003, "d": 15.0},{"x": 20.765,"y": -102.94000000000005, "r": -103.09217528590028, "d": 14.0},{"x": 28.415000000000006,"y": -82.78000000000009, "r": -82.93217528590031, "d": 98.0}]}, {"centers": [{"x": 39.890000000000015,"y": -80.26000000000008, "r": -78.38659852917611, "d": 48.5},{"x": 29.945000000000007,"y": -116.80000000000003, "r": -123.74659852917604, "d": 2.5},{"x": 30.710000000000008,"y": -91.60000000000007, "r": -90.98659852917609, "d": 11.125},{"x": 36.83000000000001,"y": -89.08000000000007, "r": -90.98659852917609, "d": 19.0},{"x": 31.47500000000001,"y": -116.80000000000003, "r": -123.74659852917604, "d": 5.5},{"x": 39.890000000000015,"y": -82.78000000000009, "r": -80.90659852917611, "d": 15.625},{"x": 41.420000000000016,"y": -82.78000000000009, "r": -80.90659852917611, "d": 15.625},{"x": 26.120000000000005,"y": -80.26000000000008, "r": -78.38659852917611, "d": 13.5},{"x": 42.95000000000002,"y": -94.12000000000006, "r": -93.50659852917609, "d": 4.25},{"x": 32.24000000000001,"y": -86.56000000000007, "r": -86.86435057180054, "d": 4.5},{"x": 36.83000000000001,"y": -99.16000000000005, "r": -101.06659852917608, "d": 5.125},{"x": 26.120000000000005,"y": -109.24000000000004, "r": -108.62659852917606, "d": 5.5},{"x": 39.125000000000014,"y": -92.86000000000007, "r": -98.74897131024085, "d": 12.428572},{"x": 20.765,"y": -94.12000000000006, "r": -101.06659852917608, "d": 15.125},{"x": 41.420000000000016,"y": -114.28000000000003, "r": -116.18659852917605, "d": 3.625},{"x": 41.420000000000016,"y": -111.76000000000003, "r": -113.66659852917606, "d": 3.625},{"x": 38.360000000000014,"y": -121.84000000000002, "r": -121.22659852917604, "d": 12.75},{"x": 22.295,"y": -101.68000000000005, "r": -108.62659852917606, "d": 4.375}]}, {"centers": [{"x": 22.295,"y": -106.72000000000004, "r": -122.44870114360096, "d": 2.1875},{"x": 37.59500000000001,"y": -85.30000000000007, "r": -82.2694133317747, "d": 5.3333335},{"x": 35.30000000000001,"y": -116.80000000000003, "r": -122.44870114360096, "d": 14.125},{"x": 20.765,"y": -104.20000000000005, "r": -119.92870114360096, "d": 7.5625},{"x": 44.48000000000002,"y": -124.36000000000001, "r": -123.0423826185975, "d": 2.5},{"x": 41.420000000000016,"y": -80.26000000000008, "r": -78.01675065521998, "d": 38.8},{"x": 29.945000000000007,"y": -90.34000000000006, "r": -89.82941333177469, "d": 6.9333334},{"x": 41.420000000000016,"y": -82.78000000000009, "r": -80.53675065521998, "d": 12.5},{"x": 31.47500000000001,"y": -118.06000000000003, "r": -126.07652585770072, "d": 4.888889},{"x": 29.180000000000007,"y": -116.80000000000003, "r": -122.44870114360096, "d": 2.8125},{"x": 26.120000000000005,"y": -80.26000000000008, "r": -78.38659852917611, "d": 13.5},{"x": 42.95000000000002,"y": -94.12000000000006, "r": -93.50659852917609, "d": 4.25},{"x": 41.420000000000016,"y": -113.02000000000004, "r": -115.81675065521992, "d": 2.9},{"x": 22.295,"y": -109.24000000000004, "r": -124.96870114360095, "d": 2.1875},{"x": 33.77000000000001,"y": -116.80000000000003, "r": -122.44870114360096, "d": 14.125},{"x": 25.355000000000004,"y": -104.20000000000005, "r": -119.92870114360096, "d": 4.375}]}, {"centers": [{"x": 37.59500000000001,"y": -85.30000000000007, "r": -82.2694133317747, "d": 5.3333335},{"x": 35.30000000000001,"y": -118.06000000000003, "r": -124.69989779376407, "d": 12.555555},{"x": 25.355000000000004,"y": -106.72000000000004, "r": -124.69989779376407, "d": 3.8888888},{"x": 29.945000000000007,"y": -90.34000000000006, "r": -89.82941333177469, "d": 6.9333334},{"x": 22.295,"y": -107.98000000000005, "r": -124.832321689097, "d": 2.0588236},{"x": 41.420000000000016,"y": -82.78000000000009, "r": -80.53675065521998, "d": 12.5},{"x": 20.765,"y": -106.72000000000004, "r": -124.69989779376407, "d": 6.7222223},{"x": 33.77000000000001,"y": -118.06000000000003, "r": -124.69989779376407, "d": 12.555555},{"x": 42.95000000000002,"y": -94.12000000000006, "r": -93.50659852917609, "d": 4.25},{"x": 34.53500000000001,"y": -80.26000000000008, "r": -76.69110402408238, "d": 20.842106},{"x": 45.24500000000002,"y": -125.62, "r": -124.32330939089503, "d": 1.4285715},{"x": 42.18500000000002,"y": -109.24000000000004, "r": -113.89278945202187, "d": 5.4166665},{"x": 27.650000000000006,"y": -111.76000000000003, "r": -121.45278945202186, "d": 1.375},{"x": 23.825000000000003,"y": -106.72000000000004, "r": -124.69989779376407, "d": 1.0555556},{"x": 30.710000000000008,"y": -118.06000000000003, "r": -124.69989779376407, "d": 3.5555556}]}, {"centers": [{"x": 25.355000000000004,"y": -106.72000000000004, "r": -124.69989779376407, "d": 3.8888888},{"x": 29.945000000000007,"y": -90.34000000000006, "r": -89.82941333177469, "d": 6.9333334},{"x": 22.295,"y": -107.98000000000005, "r": -124.832321689097, "d": 2.0588236},{"x": 20.765,"y": -106.72000000000004, "r": -124.69989779376407, "d": 6.7222223},{"x": 42.95000000000002,"y": -94.12000000000006, "r": -93.50659852917609, "d": 4.25},{"x": 34.53500000000001,"y": -80.26000000000008, "r": -76.69110402408238, "d": 20.842106},{"x": 45.24500000000002,"y": -125.62, "r": -124.32330939089503, "d": 1.4285715},{"x": 37.59500000000001,"y": -84.04000000000008, "r": -80.49219414325856, "d": 11.433333},{"x": 29.945000000000007,"y": -118.06000000000003, "r": -123.64357392789624, "d": 3.2962964},{"x": 42.18500000000002,"y": -109.24000000000004, "r": -113.89278945202187, "d": 5.4166665},{"x": 23.825000000000003,"y": -106.72000000000004, "r": -124.69989779376407, "d": 1.0555556},{"x": 36.06500000000001,"y": -118.06000000000003, "r": -123.64357392789624, "d": 8.481482}]}, {"centers": [{"x": 24.590000000000003,"y": -106.72000000000004, "r": -122.75305171540143, "d": 2.4166667},{"x": 29.945000000000007,"y": -90.34000000000006, "r": -89.82941333177469, "d": 6.9333334},{"x": 42.95000000000002,"y": -94.12000000000006, "r": -93.50659852917609, "d": 4.25},{"x": 34.53500000000001,"y": -80.26000000000008, "r": -76.69110402408238, "d": 20.842106},{"x": 29.180000000000007,"y": -118.06000000000003, "r": -122.75305171540143, "d": 2.4722223},{"x": 45.24500000000002,"y": -125.62, "r": -124.32330939089503, "d": 1.4285715},{"x": 37.59500000000001,"y": -84.04000000000008, "r": -80.49219414325856, "d": 11.433333},{"x": 42.18500000000002,"y": -109.24000000000004, "r": -113.89278945202187, "d": 5.4166665},{"x": 36.06500000000001,"y": -118.06000000000003, "r": -123.64357392789624, "d": 8.481482},{"x": 21.53,"y": -106.72000000000004, "r": -122.75305171540143, "d": 4.138889}]}, {"centers": [{"x": 24.590000000000003,"y": -106.72000000000004, "r": -122.75305171540143, "d": 2.4166667},{"x": 29.945000000000007,"y": -90.34000000000006, "r": -89.82941333177469, "d": 6.9333334},{"x": 34.53500000000001,"y": -80.26000000000008, "r": -76.69110402408238, "d": 20.842106},{"x": 29.180000000000007,"y": -118.06000000000003, "r": -122.75305171540143, "d": 2.4722223},{"x": 45.24500000000002,"y": -125.62, "r": -124.32330939089503, "d": 1.4285715},{"x": 37.59500000000001,"y": -84.04000000000008, "r": -80.49219414325856, "d": 11.433333},{"x": 42.95000000000002,"y": -105.46000000000004, "r": -111.9715221796967, "d": 3.9772727},{"x": 36.06500000000001,"y": -118.06000000000003, "r": -123.64357392789624, "d": 8.481482},{"x": 21.53,"y": -106.72000000000004, "r": -122.75305171540143, "d": 4.138889}]}, {"centers": [{"x": 24.590000000000003,"y": -106.72000000000004, "r": -122.75305171540143, "d": 2.4166667},{"x": 29.945000000000007,"y": -90.34000000000006, "r": -89.82941333177469, "d": 6.9333334},{"x": 34.53500000000001,"y": -80.26000000000008, "r": -76.69110402408238, "d": 20.842106},{"x": 29.180000000000007,"y": -118.06000000000003, "r": -122.75305171540143, "d": 2.4722223},{"x": 45.24500000000002,"y": -125.62, "r": -124.32330939089503, "d": 1.4285715},{"x": 37.59500000000001,"y": -84.04000000000008, "r": -80.49219414325856, "d": 11.433333},{"x": 42.95000000000002,"y": -105.46000000000004, "r": -111.9715221796967, "d": 3.9772727},{"x": 36.06500000000001,"y": -118.06000000000003, "r": -123.64357392789624, "d": 8.481482},{"x": 21.53,"y": -106.72000000000004, "r": -122.75305171540143, "d": 4.138889}]}, {"centers": [{"x": 29.945000000000007,"y": -90.34000000000006, "r": -89.82941333177469, "d": 6.9333334},{"x": 49.83500000000002,"y": -92.86000000000007, "r": -103.04576108984838, "d": 0.8181818},{"x": 34.53500000000001,"y": -82.78000000000009, "r": -78.1961068252457, "d": 10.333333},{"x": 29.180000000000007,"y": -118.06000000000003, "r": -122.75305171540143, "d": 2.4722223},{"x": 45.24500000000002,"y": -125.62, "r": -124.32330939089503, "d": 1.4285715},{"x": 42.95000000000002,"y": -105.46000000000004, "r": -111.9715221796967, "d": 3.9772727},{"x": 36.06500000000001,"y": -118.06000000000003, "r": -123.64357392789624, "d": 8.481482}]}, {"centers": [{"x": 29.945000000000007,"y": -90.34000000000006, "r": -89.82941333177469, "d": 6.9333334},{"x": 49.83500000000002,"y": -92.86000000000007, "r": -103.04576108984838, "d": 0.8181818},{"x": 34.53500000000001,"y": -82.78000000000009, "r": -78.1961068252457, "d": 10.333333},{"x": 45.24500000000002,"y": -125.62, "r": -124.32330939089503, "d": 1.4285715},{"x": 42.95000000000002,"y": -105.46000000000004, "r": -111.9715221796967, "d": 3.9772727},{"x": 32.24000000000001,"y": -118.06000000000003, "r": -119.99979558752811, "d": 4.4166665}]}, {"centers": [{"x": 29.945000000000007,"y": -90.34000000000006, "r": -89.82941333177469, "d": 6.9333334},{"x": 49.83500000000002,"y": -92.86000000000007, "r": -103.04576108984838, "d": 0.8181818},{"x": 34.53500000000001,"y": -82.78000000000009, "r": -78.1961068252457, "d": 10.333333},{"x": 45.24500000000002,"y": -125.62, "r": -124.32330939089503, "d": 1.4285715},{"x": 42.95000000000002,"y": -105.46000000000004, "r": -111.9715221796967, "d": 3.9772727},{"x": 32.24000000000001,"y": -118.06000000000003, "r": -119.99979558752811, "d": 4.4166665}]}]}');
/*
var rawData3 = JSON.parse('{"clusters": [{"centers": [{"x": 26.885000000000005,"y": -82.78000000000009, "r": -82.93217528590031, "d": 1.0},{"x": 36.06500000000001,"y": -118.06000000000003, "r": -118.21217528590026, "d": 1.0},{"x": 43.71500000000002,"y": -85.30000000000007, "r": -85.45217528590031, "d": 1.0},{"x": 25.355000000000004,"y": -100.42000000000004, "r": -100.57217528590029, "d": 2.0},{"x": 20.765,"y": -100.42000000000004, "r": -100.57217528590029, "d": 1.0},{"x": 36.06500000000001,"y": -90.34000000000006, "r": -90.4921752859003, "d": 1.0},{"x": 34.53500000000001,"y": -102.94000000000005, "r": -103.09217528590028, "d": 2.0},{"x": 45.24500000000002,"y": -90.34000000000006, "r": -90.4921752859003, "d": 2.0},{"x": 29.945000000000007,"y": -90.34000000000006, "r": -90.4921752859003, "d": 1.0}]}, {"centers": [{"x": 20.765,"y": -101.68000000000005, "r": -108.62659852917606, "d": 0.125},{"x": 20.765,"y": -104.20000000000005, "r": -111.14659852917606, "d": 0.125},{"x": 20.765,"y": -106.72000000000004, "r": -113.66659852917606, "d": 0.125},{"x": 25.355000000000004,"y": -101.68000000000005, "r": -108.62659852917606, "d": 0.25},{"x": 39.890000000000015,"y": -102.94000000000005, "r": -101.06659852917608, "d": 0.25},{"x": 25.355000000000004,"y": -104.20000000000005, "r": -111.14659852917606, "d": 0.25},{"x": 32.24000000000001,"y": -102.94000000000005, "r": -101.06659852917608, "d": 0.25},{"x": 44.48000000000002,"y": -85.30000000000007, "r": -83.4265985291761, "d": 0.125},{"x": 20.765,"y": -94.12000000000006, "r": -101.06659852917608, "d": 0.125},{"x": 25.355000000000004,"y": -99.16000000000005, "r": -106.10659852917607, "d": 0.25},{"x": 33.77000000000001,"y": -102.94000000000005, "r": -101.06659852917608, "d": 0.25},{"x": 20.765,"y": -96.64000000000006, "r": -103.58659852917607, "d": 0.125},{"x": 36.83000000000001,"y": -102.94000000000005, "r": -101.06659852917608, "d": 0.25},{"x": 42.95000000000002,"y": -85.30000000000007, "r": -83.4265985291761, "d": 0.125},{"x": 27.650000000000006,"y": -82.78000000000009, "r": -80.90659852917611, "d": 0.125},{"x": 29.180000000000007,"y": -82.78000000000009, "r": -80.90659852917611, "d": 0.125},{"x": 25.355000000000004,"y": -96.64000000000006, "r": -103.58659852917607, "d": 0.25},{"x": 34.53500000000001,"y": -104.20000000000005, "r": -111.14659852917606, "d": 0.25},{"x": 38.360000000000014,"y": -102.94000000000005, "r": -101.06659852917608, "d": 0.25},{"x": 43.71500000000002,"y": -89.08000000000007, "r": -96.02659852917608, "d": 0.125},{"x": 26.120000000000005,"y": -82.78000000000009, "r": -80.90659852917611, "d": 0.125},{"x": 20.765,"y": -99.16000000000005, "r": -106.10659852917607, "d": 0.125},{"x": 35.30000000000001,"y": -102.94000000000005, "r": -101.06659852917608, "d": 0.25},{"x": 29.945000000000007,"y": -89.08000000000007, "r": -96.02659852917608, "d": 0.125},{"x": 34.53500000000001,"y": -101.68000000000005, "r": -108.62659852917606, "d": 0.25},{"x": 36.06500000000001,"y": -91.60000000000007, "r": -98.54659852917608, "d": 0.125},{"x": 36.06500000000001,"y": -89.08000000000007, "r": -96.02659852917608, "d": 0.125},{"x": 34.53500000000001,"y": -106.72000000000004, "r": -113.66659852917606, "d": 0.25},{"x": 41.420000000000016,"y": -118.06000000000003, "r": -116.18659852917605, "d": 0.125}]}, {"centers": [{"x": 25.355000000000004,"y": -106.72000000000004, "r": -122.44870114360096, "d": 0.125},{"x": 38.360000000000014,"y": -102.94000000000005, "r": -99.76870114360099, "d": 0.125},{"x": 29.945000000000007,"y": -90.34000000000006, "r": -92.34941333177468, "d": 0.06666667},{"x": 20.765,"y": -104.20000000000005, "r": -119.92870114360096, "d": 0.0625},{"x": 33.77000000000001,"y": -119.32000000000002, "r": -117.40870114360096, "d": 0.0625},{"x": 33.77000000000001,"y": -116.80000000000003, "r": -114.88870114360097, "d": 0.0625},{"x": 20.765,"y": -106.72000000000004, "r": -122.44870114360096, "d": 0.0625},{"x": 45.24500000000002,"y": -85.30000000000007, "r": -84.7894133317747, "d": 0.06666667},{"x": 35.30000000000001,"y": -116.80000000000003, "r": -114.88870114360097, "d": 0.0625},{"x": 43.71500000000002,"y": -85.30000000000007, "r": -84.7894133317747, "d": 0.06666667},{"x": 35.30000000000001,"y": -119.32000000000002, "r": -117.40870114360096, "d": 0.0625},{"x": 35.30000000000001,"y": -91.60000000000007, "r": -92.208701143601, "d": 0.0625},{"x": 35.30000000000001,"y": -89.08000000000007, "r": -89.68870114360101, "d": 0.0625},{"x": 20.765,"y": -109.24000000000004, "r": -124.96870114360095, "d": 0.0625},{"x": 32.24000000000001,"y": -119.32000000000002, "r": -117.40870114360096, "d": 0.0625},{"x": 25.355000000000004,"y": -109.24000000000004, "r": -124.96870114360095, "d": 0.125},{"x": 32.24000000000001,"y": -116.80000000000003, "r": -114.88870114360097, "d": 0.0625},{"x": 25.355000000000004,"y": -82.78000000000009, "r": -82.2694133317747, "d": 0.06666667}]}, {"centers": [{"x": 33.77000000000001,"y": -102.94000000000005, "r": -101.29278945202189, "d": 0.083333336},{"x": 35.30000000000001,"y": -104.20000000000005, "r": -106.33278945202188, "d": 0.083333336},{"x": 42.95000000000002,"y": -94.12000000000006, "r": -103.81278945202189, "d": 0.041666668},{"x": 26.120000000000005,"y": -82.78000000000009, "r": -81.13278945202192, "d": 0.041666668},{"x": 35.30000000000001,"y": -119.32000000000002, "r": -121.45278945202186, "d": 0.041666668},{"x": 25.355000000000004,"y": -99.16000000000005, "r": -103.81278945202189, "d": 0.083333336},{"x": 35.30000000000001,"y": -102.94000000000005, "r": -101.29278945202189, "d": 0.083333336},{"x": 24.590000000000003,"y": -84.04000000000008, "r": -83.65278945202192, "d": 0.041666668},{"x": 25.355000000000004,"y": -101.68000000000005, "r": -106.33278945202188, "d": 0.083333336},{"x": 27.650000000000006,"y": -84.04000000000008, "r": -83.65278945202192, "d": 0.041666668}]}, {"centers": [{"x": 33.77000000000001,"y": -119.32000000000002, "r": -115.5731970583521, "d": 0.03125},{"x": 42.95000000000002,"y": -97.90000000000006, "r": -110.73219414325851, "d": 0.033333335},{"x": 25.355000000000004,"y": -101.68000000000005, "r": -108.21219414325851, "d": 0.06666667},{"x": 25.355000000000004,"y": -104.20000000000005, "r": -110.73219414325851, "d": 0.06666667},{"x": 35.30000000000001,"y": -102.94000000000005, "r": -103.17219414325852, "d": 0.06666667},{"x": 26.885000000000005,"y": -82.78000000000009, "r": -80.80357392789631, "d": 0.037037037},{"x": 35.30000000000001,"y": -119.32000000000002, "r": -115.5731970583521, "d": 0.03125},{"x": 25.355000000000004,"y": -101.68000000000005, "r": -103.17219414325852, "d": 0.06666667}]}, {"centers": [{"x": 36.06500000000001,"y": -119.32000000000002, "r": -122.3935013104398, "d": 0.025},{"x": 34.53500000000001,"y": -119.32000000000002, "r": -122.3935013104398, "d": 0.025},{"x": 35.30000000000001,"y": -102.94000000000005, "r": -102.23350131043983, "d": 0.05},{"x": 35.30000000000001,"y": -118.06000000000003, "r": -117.35350131043981, "d": 0.025},{"x": 29.945000000000007,"y": -82.78000000000009, "r": -79.64163687787078, "d": 0.025641026},{"x": 30.710000000000008,"y": -92.86000000000007, "r": -89.99305171540148, "d": 0.027777778}]}, {"centers": [{"x": 34.53500000000001,"y": -118.06000000000003, "r": -116.928485896356, "d": 0.022222223},{"x": 35.30000000000001,"y": -104.20000000000005, "r": -104.08476523719501, "d": 0.041666668},{"x": 36.06500000000001,"y": -118.06000000000003, "r": -116.928485896356, "d": 0.022222223},{"x": 29.945000000000007,"y": -82.78000000000009, "r": -79.64163687787078, "d": 0.025641026},{"x": 30.710000000000008,"y": -92.86000000000007, "r": -89.99305171540148, "d": 0.027777778}]}, {"centers": [{"x": 46.77500000000002,"y": -101.68000000000005, "r": -116.21918417803278, "d": 0.037037037},{"x": 34.53500000000001,"y": -118.06000000000003, "r": -116.14415203132616, "d": 0.018181818},{"x": 35.30000000000001,"y": -104.20000000000005, "r": -104.08476523719501, "d": 0.041666668},{"x": 29.945000000000007,"y": -82.78000000000009, "r": -79.64163687787078, "d": 0.025641026},{"x": 36.06500000000001,"y": -118.06000000000003, "r": -116.14415203132616, "d": 0.018181818}]}, {"centers": [{"x": 35.30000000000001,"y": -82.78000000000009, "r": -77.97882666354931, "d": 0.016666668},{"x": 35.30000000000001,"y": -104.20000000000005, "r": -104.08476523719501, "d": 0.041666668},{"x": 35.30000000000001,"y": -118.06000000000003, "r": -115.77882666354927, "d": 0.016666668}]}, {"centers": [{"x": 32.24000000000001,"y": -120.58000000000001, "r": -117.61127345306188, "d": 0.014285714},{"x": 35.30000000000001,"y": -82.78000000000009, "r": -77.97882666354931, "d": 0.016666668},{"x": 35.30000000000001,"y": -104.20000000000005, "r": -104.08476523719501, "d": 0.041666668}]}, {"centers": [{"x": 33.00500000000001,"y": -120.58000000000001, "r": -117.28595654649374, "d": 0.013333334},{"x": 35.30000000000001,"y": -82.78000000000009, "r": -77.97882666354931, "d": 0.016666668},{"x": 35.30000000000001,"y": -104.20000000000005, "r": -104.08476523719501, "d": 0.041666668}]}]}');*/

  //Graphical environnement
var graph = document.getElementById("map").getElementsByTagName("svg")[0].appendChild(po.svg("g"));


function cluster(view_center, zoom, data) {
  rawData1 = JSON.parse(data); update2();
  if(view_center) map.center(view_center);
  if(zoom) map.zoom(zoom);
}
//Translating function 
  /*@brief: Transforms the raw data in pixels
    @expects: [{x, y, r}, {x,y,r}...]
  */
function generateData(centers){
  var res = [];
  for(var i = 0; i < centers.length; i++) {
    var e = centers[i];
    var bitch = JSON.parse('{"x": '+e.r+', "y": '+e.y+'}');
    var border = geoToPx(bitch);
    var toPix = geoToPx(e);
    var diff = border.y - toPix.y;
    var nR = Math.abs(border.y - toPix.y);
    /*console.log("DA GEO "+JSON.stringify(toPix));
    console.log("DA Border "+JSON.stringify(border));
    console.log("DA e"+JSON.stringify(e));
    console.log("DA nR "+ nR);*/
    res.push(JSON.parse('{"x":'+toPix.x+', "y":'+toPix.y+', "r": '+nR+', "d": '+e.d+'}'));
    
  }
  return res;
}

//Functions to draw
  //Expects input of the form {"x": _, "y": _, "r": _}
var colors = ["", "LightCoral", "RoyalBlue", "Purple"]
function drawCircle(entry, colorID) {
  var point = graph.appendChild(po.svg("circle"));
  point.setAttribute('style', 'fill:'+ colors[colorID] +"; "+point.getAttribute("fill"));
  point.setAttribute('style', 'opacity:'+entry.d / 120+"; "+point.getAttribute("style"));
  point.setAttribute("cx", entry.x);
  point.setAttribute("cy", entry.y);
  point.setAttribute("r", entry.r);
}

  //Goes through the list of centers at one level
function drawCenters(clusts, colorID){
  for(var i = 0; i < clusts.length; i++) {
    drawCircle(clusts[i], colorID);
  }
}


//Helper functions
  //Translates pixels {"x": _, "y":_, "r":_ } into geolocation 
  //using only the x and y attribute; Returns {"lat":_, "lon":_}
function pxToGeo(pt){
  return map.pointLocation(JSON.parse('{"x":'+ pt.x+', "y": '+pt.y+'}'));
}

  //Translates geolocation {"lat": _, "lon":_} into pixel {"x":_, "y": _}
function geoToPx(pt){
  //Trouble parsing here
  return map.locationPoint(JSON.parse('{ "lat":'+pt.x+', "lon": '+pt.y+'}'));
}

function update2() {
  //custers: 0 (more details) ->  9
  //zoom level:  3 (far zoom) -> 10
  console.log("HEEEEEEEEEEEEEEEEEEEERRRRRRRRRRRREEEEEEEEE");
  while(graph.firstChild){
    graph.removeChild(graph.firstChild);
  }
 
  drawCenters(generateData(rawData1.clusters[0].centers), 1);
  console.log(Math.floor(map.zoom()));
  drawCenters(generateData(rawData2.clusters[9].centers), 2);
  //drawCenters(generateData(rawData3.clusters[10 - (Math.floor(map.zoom()) - 3)].centers), 3);

}

update2();
  //Tests drawCenters
//drawCenters(generateData(rawData1.clusters[0].centers), 1);
/*drawCenters(generateDate(rawData2.clusters[0].centers), 2);
drawCenters(generateDate(rawData3.clusters[0].centers), 3);  */
  //Tests
//var res = geoToPx(JSON.parse('{"x": 37.787, "y": -122.228}'));
//var res2 = geoToPx(JSON.parse('{"x": 37.787, "y": -132.228}'));
//var res2 = pxToGeo(JSON.parse('{"x": 758.9, "y": 160}'));



//drawCircle(JSON.parse('{"x": 0, "y": 300, "r": 30}'))

