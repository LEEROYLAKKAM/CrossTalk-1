\section{Partitioning the map}
\label{sec:partitioning}

\section{Interaction between the front and back end}
\label{sec:task_controller}

Joris and Lewis designed and implemented the actions which are called by the
front end once the user has selected the search parameters.  These were
implemented using Play \verb+Action+s which are invoked upon HTTP requests to
particular routes.

There are a handful of these actions, the most important of which are for
starting the data collection and computing the display data.  When the
\verb+Start+ action is invoked the \verb+GeoPartitioner+ actors are
instantiated and started with the desired parameters.  In order to be able to
display intersections between the requested keywords, we spawned three
partitioners for each user-selected area: one for each of the keywords, and
another for their intersection.  Twitter's search API allows keywords to be
combined with logical conjunctions and disjunctions, which we used to create
these queries.

When it comes to displaying the data, there are two requests the user can make:
they can request either clustered data or squares with opacities.  In both
cases, the Tweet counts for the Venn diagram are assembled and filtered to
whatever square is currently displayed.  The desired data (either clusters or
opacities) are collected and transformed into the format expected
by the front end, and everything is passed to a view which is shown to the
end-user.  There is also an action to refresh the Venn diagram to display the
statistics for the area currently visible to the end-user.

In order to test these actions, it is helpful to be able remove the dependency
on the Twitter API.  By doing this, it is possible to write unit tests which
only run the task controller code.  This reduces the number of reasons for which
the tests can fail, making them more reliable and useful.  To accomplish this,
we proceeded as is done in the Cake pattern.  All of the actors that were used
were put into an abstract trait, \verb+actors+.  There was then a concrete
implementation of this trait which used the real actors, contacting the Twitter
API and so on, and a test implementation which mocked those actors instead.
